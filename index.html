<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Hecuba : The abstraction over all cassandra clients (like Hector and Astyanax)" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Hecuba</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/WizeCommerce/hecuba">View on GitHub</a>

          <h1 id="project_title">Hecuba</h1>
          <h2 id="project_tagline">The abstraction over all cassandra clients (like Hector and Astyanax)</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/WizeCommerce/hecuba/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/WizeCommerce/hecuba/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="hecuba" class="anchor" href="#hecuba"><span class="octicon octicon-link"></span></a>Hecuba</h1>

<p>There are few widely used Apache Cassandra clients and Hecuba is the abstraction over those clients so that you can switch between those easily.</p>

<p>Hecuba is currently in use in Wize Commerce and is being actively developed. </p>

<h1>
<a name="why-hecuba" class="anchor" href="#why-hecuba"><span class="octicon octicon-link"></span></a>Why Hecuba</h1>

<p>In greek mythology <a href="http://en.wikipedia.org/wiki/Hecuba">Hecuba</a> is the mother of <a href="http://en.wikipedia.org/wiki/Hector">Hector</a> and <a href="http://en.wikipedia.org/wiki/Cassandra">Cassandra</a> and grand mother of <a href="http://en.wikipedia.org/wiki/Astyanax">Asytanax</a>. Whereas in NoSQL world Cassandra is a NoSQL storage, Hector and Astyanax are clients (Astyanax had initially spawned off of Hector) and Hecuba is the abstraction over Astyanax and Hector.    </p>

<h1>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h1>

<ul>
<li>Hecuba supports all the regular methods to interact with Cassandra including gets, multigets, row and column slices, writes and deletes. </li>
<li>Hecuba can be used to maintain your own secondary index without relying on Cassandra's implementation of secondary indexes. The main difference here is that Cassandra implementation tries to maintain the locality of the secondary indexes with the knowledge of the topology whereas hecuba implementation consider secondary index as another independent column family with pointers to the main table. </li>
</ul><h1>
<a name="user-guide" class="anchor" href="#user-guide"><span class="octicon octicon-link"></span></a>User Guide</h1>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a name="initialization" class="anchor" href="#initialization"><span class="octicon octicon-link"></span></a>Initialization</h3>

<div class="highlight highlight-java"><pre>    <span class="n">CassandraParamsBean</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CassandraParamsBean</span><span class="o">();</span>
    <span class="n">parameters</span><span class="o">.</span><span class="na">setClusterName</span><span class="o">(</span><span class="s">"Cluster Name"</span><span class="o">);</span>  <span class="c1">// set the name of the cluster. You can find the name of the cluster from cassandra.yaml file</span>
    <span class="n">parameters</span><span class="o">.</span><span class="na">setLocationURLs</span><span class="o">(</span><span class="s">"node1:node2:node3"</span><span class="o">);</span> <span class="c1">// list of nodes in the cluster separated by ':'</span>
    <span class="n">parameters</span><span class="o">.</span><span class="na">setThriftPorts</span><span class="o">(</span><span class="s">"9180"</span><span class="o">);</span> <span class="c1">// port the above cassandra nodes listening to for client requests</span>
    <span class="n">parameters</span><span class="o">.</span><span class="na">setKeyspace</span><span class="o">(</span><span class="s">"MyKeyspace"</span><span class="o">);</span> <span class="c1">// the keyspace you need to connect to</span>
    <span class="n">parameters</span><span class="o">.</span><span class="na">setCf</span><span class="o">(</span><span class="s">"MyColumnFamily"</span><span class="o">);</span> <span class="c1">// the column family you need to connect to</span>
    <span class="n">parameters</span><span class="o">.</span><span class="na">setKeyType</span><span class="o">(</span><span class="s">"Long"</span><span class="o">)</span> <span class="c1">// the java type of the keys of the cassandra cluster. This can be either Long or String.</span>

    <span class="c1">// initialize a client based on Astyanax</span>
    <span class="c1">//HecubaClientManager&lt;String&gt; cassandraManager = new AstyanaxBasedHecubaClientManager&lt;String&gt;(parameters, com.netflix.astyanax.serializer.StringSerializer.get());</span>

    <span class="c1">// or initialize a client based on Hector</span>
    <span class="n">HecubaClientManager</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">cassandraManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HectorBasedHecubaClientManager</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">parameters</span><span class="o">,</span> <span class="n">me</span><span class="o">.</span><span class="na">prettyprint</span><span class="o">.</span><span class="na">cassandra</span><span class="o">.</span><span class="na">serializers</span><span class="o">.</span><span class="na">StringSerializer</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="kc">true</span><span class="o">);</span>
</pre></div>

<h3>
<a name="write-data" class="anchor" href="#write-data"><span class="octicon octicon-link"></span></a>Write data</h3>

<div class="highlight highlight-java"><pre>   <span class="c1">// update a single column. Similarly, you can invoke updateDouble, updateLong, etc</span>
   <span class="n">cassandraManager</span><span class="o">.</span><span class="na">updateString</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">columnName</span><span class="o">,</span> <span class="n">columnValue</span><span class="o">);</span>

   <span class="c1">// update a single column with timestamp and ttl. By default each of these values are set to -1 so that the underlying client implementations will provide timestamps and set the TTL to never expire.</span>
   <span class="n">cassandraManager</span><span class="o">.</span><span class="na">updateString</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">columnName</span><span class="o">,</span> <span class="n">columnValue</span><span class="o">,</span> <span class="n">timestamp</span><span class="o">,</span> <span class="n">ttl</span><span class="o">);</span>

   <span class="c1">// update a whole row at once by passing a map of column names and values. Values can be strings, longs, booleans or Dates. Everything else has to be implement toString otherwise. </span>
   <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">columns</span> <span class="o">=</span> <span class="o">...</span>
   <span class="n">cassandraManager</span><span class="o">.</span><span class="na">updateRow</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">columns</span><span class="o">);</span>

   <span class="c1">// update a whole row with ttls and timestamps</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">timestamps</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ttls</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">cassandraManager</span><span class="o">.</span><span class="na">updateRow</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">columns</span><span class="o">,</span> <span class="n">timestamps</span><span class="o">,</span> <span class="n">ttls</span><span class="o">);</span>
</pre></div>

<h3>
<a name="read-data" class="anchor" href="#read-data"><span class="octicon octicon-link"></span></a>Read data</h3>

<div class="highlight highlight-java"><pre>
    <span class="c1">// read all columns of a single row (single get)</span>
    <span class="n">CassandraResultSet</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">columnValues</span> <span class="o">=</span> <span class="n">cassandraManager</span><span class="o">.</span><span class="na">readAllColumns</span><span class="o">(</span><span class="n">objectId</span><span class="o">);</span>

    <span class="c1">// read all columns of multiple rows (multi get)</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">keysOfObjectsToBeRetrieved</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;();</span>
    <span class="n">CassandraResultSet</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">columnValues</span> <span class="o">=</span> <span class="n">cassandraManager</span><span class="o">.</span><span class="na">readAllColumns</span><span class="o">(</span><span class="n">keysOfObjectsToBeRetrieved</span><span class="o">);</span>

    <span class="c1">// read single column as string. </span>
    <span class="n">String</span> <span class="n">stringColumnValue</span> <span class="o">=</span> <span class="n">cassandraManager</span><span class="o">.</span><span class="na">readString</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">stringColumnName</span><span class="o">);</span>

    <span class="c1">// read single column as double</span>
    <span class="n">Double</span> <span class="n">doubleValue</span> <span class="o">=</span> <span class="n">cassandraManager</span><span class="o">.</span><span class="na">readDouble</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">doubleColumnValue</span><span class="o">);</span>

    <span class="c1">// you can even pass in the default value so that this method returns it if there is no value found for that column inside Cassandra. You can similarly use readBoolean, readInteger methods. </span>
    <span class="n">Double</span> <span class="n">doubleValue</span> <span class="o">=</span> <span class="n">cassandraManager</span><span class="o">.</span><span class="na">readDouble</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">doubleColumnValue</span><span class="o">,</span> <span class="n">defaultDoubleValue</span><span class="o">);</span>

    <span class="c1">// read only a given set of columns for an object.</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">columnsNamesToBeRetrieved</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">CassandraResultSet</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">cassandraManager</span><span class="o">.</span><span class="na">readColumns</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">columnsNamesToBeRetrieved</span><span class="o">);</span> 

    <span class="c1">// similarly you can pass in a set of keys if you want to read columns of multiple keys.</span>
</pre></div>

<h1>
<a name="current-limitations" class="anchor" href="#current-limitations"><span class="octicon octicon-link"></span></a>Current Limitations</h1>

<ul>
<li>Hecuba assumes all column names and values are strings. </li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Hecuba maintained by <a href="https://github.com/WizeCommerce">WizeCommerce</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
